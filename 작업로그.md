# 2026 임상심리전문가 자격시험 준비 스터디룸 - 작업 로그

## 프로젝트 개요
- **프로젝트명**: 온라인 도서관 입퇴실 대시보드
- **URL**: https://26cp-studyroom.vercel.app
- **GitHub**: https://github.com/psyoonchild719/online-library-dashboard.git
- **작업 기간**: 2026년 1월 24일

---

## 기술 스택
- **Frontend**: Next.js 14 (App Router), React, Tailwind CSS
- **Backend**: Supabase (Database, Auth, Realtime)
- **인증**: Google OAuth 2.0
- **배포**: Vercel + GitHub 연동

---

## 주요 기능

### 1. 사용자 인증
- Google 계정 로그인
- 허용된 6명의 멤버만 접근 가능 (화이트리스트)
- 허용되지 않은 사용자 접근 차단 화면

### 2. 입퇴실 관리
- 입실하기 버튼 클릭 시 Google Meet 자동 열림 + 입실 기록
- 퇴실하기 버튼으로 수동 퇴실
- 본인만 입퇴실 조작 가능

### 3. 대시보드 기능
- D-day 카운트다운 (임상심리전문가 필기 2026.02.06, 면접 2026.02.07)
- 현재 입실 멤버 수
- 평균 출석률
- 총 학습시간
- 오늘 입실 횟수
- 멤버 현황 (입실 상태 표시)
- 실시간 입퇴실 기록

### 4. 학습 시간 현황
- ⏱️ 오늘의 학습시간 (멤버별, 순위 정렬)
- 🏆 누적 학습시간 랭킹 (금/은/동메달 표시)

### 5. 개인 기록 모달
- 멤버 클릭 시 개인 기록 확인
- 총 학습시간, 출석률, 최근 출석 기록

### 6. 반응형 디자인
- 모바일/데스크톱 최적화
- 세로 배치 (모바일)

---

## 📚 면접 시뮬레이터 기능 (/interview)

### 1. 사례 유형 선택
- 전공 사례 / 윤리 사례 탭 전환
- 출처 필터: 기출 / 예상 / 전체

### 2. 사례 학습
- 사례 전문 표시/숨기기
- 질문별 순차 학습
- 모범 답안 보기/숨기기
- 자기평가 모드 (체크포인트 체크)

### 3. 학습 도구
- 타이머 기능 (시작/정지/리셋)
- 연습 횟수 카운트
- 랜덤 사례 불러오기
- 이전/다음 사례 이동

### 4. 카테고리 필터
- 전공: 강박/정신증, 우울/불안, 외상/스트레스, 성격장애, 신경발달, 신체증상, 꾀병, 섭식장애, 해리장애, 물질관련, 신경인지, 충동조절
- 윤리: 비밀유지/기록, 검사보안/평가, 다중관계, 신고의무, 동료윤리, 전문성, 무자격자, 동의/정보, 연구윤리

### 5. 고유번호 시스템 (2026.01.31 추가)
- 각 사례에 고유번호 배지 표시
- 기출 사례: 파란색 배지 (예: 전공 1, 윤리 3)
- 예상 사례: 보라색 배지 (예: 예상-전공 1)
- 새 예상 사례 추가 시 자동 번호 생성

### 6. 관리자 기능 (/interview/admin)
- 사례 CRUD (추가/수정/삭제)
- 질문 CRUD
- 출처/카테고리 관리
- 고유번호 편집

---

## 허용된 멤버 목록

| 이름 | Google 계정 |
|------|-------------|
| 김지윤 | psyoonchild@gmail.com |
| 조하나 | pit-a-pat@hotmail.co.kr |
| 곽호경 | khk9440@ewhain.net |
| 배유진 | youjin13ae@gmail.com |
| 황해인 | hipsychology@gmail.com |
| 정다운 | dawoon85@gmail.com |

---

## Supabase 설정

### 테이블 구조

**스터디룸 관련**
1. **members**: 멤버 정보 (id, name, email, avatar, auth_id, attendance_rate, total_hours)
2. **online_status**: 온라인 상태 (member_id, is_online, last_enter, last_exit)
3. **attendance_logs**: 입퇴실 기록 (member_id, action, logged_at)
4. **daily_stats**: 일일 통계 (member_id, date, total_minutes, enter_count)

**면접 시뮬레이터 관련**
5. **interview_cases**: 사례 정보 (id, case_id, type, source, title, content, category, created_at)
   - `case_id`: 고유번호 (예: 전공 1, 윤리 3, 예상-전공 1)
   - `type`: 'major' | 'ethics'
   - `source`: 'exam' | 'predicted'
6. **interview_questions**: 질문 정보 (id, case_id, question, model_answer, key_points, order_num)

### RLS 정책
- 모든 테이블에 Row Level Security 활성화
- 인증된 사용자에게 CRUD 권한 부여

### URL 설정
- **Site URL**: https://26cp-studyroom.vercel.app
- **Redirect URLs**: https://26cp-studyroom.vercel.app/**

---

## 환경 변수 (Vercel)
- `NEXT_PUBLIC_SUPABASE_URL`: Supabase 프로젝트 URL
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`: Supabase Anonymous Key

---

## 작업 히스토리

### 초기 설정
1. Next.js 프로젝트 생성
2. Supabase 연동 및 테이블 생성
3. 기본 대시보드 UI 구현

### Google 인증 추가
1. Google Cloud Console에서 OAuth 클라이언트 생성
2. Supabase Authentication에 Google Provider 설정
3. 로그인/로그아웃 기능 구현
4. 허용된 멤버 화이트리스트 적용

### UI/UX 개선
1. 모바일 반응형 레이아웃 적용
2. D-day 섹션 상단 이동
3. 주간 차트 삭제 (불필요)
4. 텍스트 수정 (입실하기, 멤버 현황 등)
5. 로그인 화면 제목 줄바꿈

### 학습 시간 기능 추가
1. 오늘의 멤버별 학습시간 섹션
2. 누적 학습시간 랭킹 섹션

### 도메인 변경
- online-library-dashboard-tau.vercel.app → 26cp-studyroom.vercel.app

---

## 파일 구조
```
online-library-app/
├── app/
│   ├── page.js              # 메인 대시보드 (스터디룸)
│   ├── layout.js            # 레이아웃
│   ├── globals.css          # 전역 스타일
│   └── interview/           # 📚 면접 시뮬레이터
│       ├── page.js          # 면접 연습 페이지
│       └── admin/
│           └── page.js      # 관리자 페이지 (사례/질문 CRUD)
├── .env.local               # 환경 변수 (로컬)
├── package.json
├── tailwind.config.js
└── 작업로그.md               # 이 파일
```

---

## Google Meet URL
- https://meet.google.com/hti-iiby-dkc

---

## 향후 개선 사항 (선택)
- 주간/월간 통계 차트 (실제 데이터 연동)
- 학습 목표 설정 기능
- 푸시 알림
- 캘린더 뷰

---

---

## 2026년 1월 31일 - 면접 시뮬레이터 고유번호 기능 추가

### 📋 요청 내용
- 각 사례에 고유번호(case_id) 할당
- 연습 페이지에서 고유번호 노출 (현재 이모지 위치)
- 기출 사례: 원래 고유번호 유지 (예: 전공-1, 윤리-3)
- 예상 사례: 새로 생성할 때마다 자동 할당 (예: 예상-전공 1)

### 🔧 코드 수정

#### 1. 관리자 페이지 (`/app/interview/admin/page.js`)
- `case_id` 필드를 newCase state에 추가
- `generateCaseId` 함수 추가 (예상 사례 자동 번호 생성)
- 기출 사례: 수동 입력 필드
- 예상 사례: 자동 생성 알림 표시
- 사례 목록 헤더에 case_id 표시
- 수정 모달에 case_id 편집 필드 추가

```javascript
// 예상 사례 고유번호 자동 생성
const generateCaseId = async (type, source) => {
  if (source === 'exam') return ''; // 기출은 수동 입력
  try {
    const { data } = await supabase
      .from('interview_cases')
      .select('case_id')
      .eq('type', type)
      .eq('source', 'predicted')
      .not('case_id', 'is', null);

    const prefix = type === 'major' ? '예상-전공' : '예상-윤리';
    let maxNum = 0;
    data?.forEach(item => {
      if (item.case_id?.startsWith(prefix)) {
        const num = parseInt(item.case_id.replace(prefix, '').trim());
        if (!isNaN(num) && num > maxNum) maxNum = num;
      }
    });
    return `${prefix} ${maxNum + 1}`;
  } catch (error) {
    console.error('고유번호 생성 실패:', error);
    return '';
  }
};
```

#### 2. 연습 페이지 (`/app/interview/page.js`)
- `caseId` 필드를 formatted case object에 추가
- 고유번호 배지 표시:
  - 기출: 파란색 (`bg-blue-100 text-blue-700`)
  - 예상: 보라색 (`bg-violet-100 text-violet-700`)

```javascript
{/* 고유번호 항상 표시 */}
{currentCase.caseId && (
  <span className={`text-xs px-2 py-1 rounded font-mono font-medium ${
    currentCase.source === 'exam'
      ? 'bg-blue-100 text-blue-700 border border-blue-200'
      : 'bg-violet-100 text-violet-700 border border-violet-200'
  }`}>
    {currentCase.caseId}
  </span>
)}
```

### 💾 데이터베이스 업데이트

#### 스키마 변경
```sql
ALTER TABLE interview_cases ADD COLUMN IF NOT EXISTS case_id TEXT;
```

#### 기존 사례 고유번호 할당 (SQL)
- 기출 전공: 28개 (전공 1 ~ 전공 28)
- 기출 윤리: 27개 (윤리 1 ~ 윤리 27)
- 예상 전공: 28개 (예상-전공 1 ~ 예상-전공 28)

**총 83개 사례에 고유번호 할당 완료**

### ✅ 완료 상태
- [x] 코드 수정 및 커밋
- [x] Vercel 배포 완료
- [x] 데이터베이스 case_id 컬럼 추가
- [x] 기존 모든 사례에 고유번호 할당
- [x] 연습 페이지 고유번호 배지 표시 확인

### 🎯 향후 자동화
- 새로운 예상 사례 추가 시 자동으로 다음 번호 부여
  - 예: 예상-전공 29, 예상-윤리 21 등
- 기출 사례는 관리자가 직접 고유번호 입력

---

## 2026년 1월 31일 - 예상 윤리 사례 20개 추가

### 📋 요청 내용
- `test_interview/면접_대비_윤리_예상문제` 폴더의 예상문제들을 DB에 추가

### 📚 추가된 사례

**총 20개 사례 (1~4회 × 5개씩)**

| 회차 | 주제 | 카테고리 | 사례 번호 |
|------|------|----------|-----------|
| 1회 | 평가 객관성 + 조직 갈등 | 검사보안/평가 | 예상-윤리 1~5 |
| 2회 | 비밀유지 + 다중관계 | 비밀유지/기록, 다중관계 | 예상-윤리 6~10 |
| 3회 | 무자격자 + 허위광고 + 전문성 | 무자격자, 전문성 | 예상-윤리 11~15 |
| 4회 | 기록보존 + 검사보안 + 치료종결 | 비밀유지/기록, 검사보안/평가, 동의/정보 | 예상-윤리 16~20 |

### 📝 사례 목록

1. 보험금 청구를 위한 진단 요청
2. 입시 목적의 ADHD 진단 요청
3. 법원 제출용 평가 결과 수정 요구
4. 기관장의 특정 결과 유도 지시
5. 산재 판정을 위한 과장된 소견 요청
6. 부모가 자녀 상담 내용 요구
7. 법원의 상담 기록 제출 요구
8. 동료가 공유 내담자 정보 요청
9. 내담자의 선물과 사적 만남 제안
10. 지인 가족 치료 요청
11. 상담사 자격만 있는 직원에게 심리검사 지시
12. SNS에 과장된 치료 성공 사례 홍보
13. 수련 경험 없는 치료기법 사용 요구
14. 타인의 자격을 도용한 홍보
15. 수련생에게 독립적 사례 배정
16. 퇴사 시 상담 기록 처리
17. 오래된 기록 폐기 요청
18. 유튜브에 심리검사 문항 노출
19. 내담자가 원검사지 복사 요청
20. 위기 내담자 담당 중 갑작스런 휴직

### ✅ 완료 상태
- [x] 예상문제 파일 분석 (1~4회 모범답안)
- [x] SQL INSERT 문 생성 (사례 20개 + 질문 20개)
- [x] Supabase SQL Editor에서 실행
- [x] DB 추가 완료

### 📊 현재 DB 현황

| 유형 | 기출 | 예상 | 합계 |
|------|------|------|------|
| 전공 | 28개 | 28개 | 56개 |
| 윤리 | 27개 | **20개** | **47개** |
| **합계** | 55개 | 48개 | **103개** |

---

---

## 2026년 2월 1일 - 토론의 방 기능 추가 및 개선

### 📋 이전 세션 작업 (채팅/알림 삭제 및 토론의 방 생성)

#### Supabase 데이터 사용량 절감
- **문제**: Egress 사용량 초과 (19.13GB / 5GB = 383%)
- **원인**: PostgREST Egress 89.4% (채팅 기능)
- **해결**: 채팅 기능 및 알림 기능 삭제

#### 토론의 방 (/qna) 페이지 신규 생성
- 질문/답변 게시판 형식
- Supabase 테이블: `questions`, `comments`
- RLS 정책 설정 (읽기, 쓰기, 수정, 삭제)
- 글/댓글 CRUD 기능 완료

### 🔧 오늘 작업 내용

#### 1. URL 링크 자동 미리보기 기능
- 이미지 URL (jpg, png, gif 등) → 인라인 미리보기
- 구글 드라이브 이미지 링크 자동 변환
- 일반 링크 → 클릭 버튼으로 표시
- 커밋: `1820d7f`

#### 2. 마크다운 지원 추가
- `react-markdown` 패키지 설치
- 지원 문법:
  - `**굵게**` → 굵게
  - `*기울임*` → 기울임
  - `- 목록` → 불릿 리스트
  - `1. 번호` → 번호 리스트
  - `` `코드` `` → 인라인 코드
  - `> 인용` → 인용문
  - `# 제목` → 헤딩
- 커밋: `76a5375`

#### 3. 줄바꿈 지원 수정
- `remark-breaks` 플러그인 추가
- 엔터 한 번으로 줄바꿈 가능
- 커밋: `f7de0a8`

### 💾 Supabase 테이블 추가

```sql
-- 질문 테이블
CREATE TABLE questions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  member_id UUID REFERENCES members(id),
  title TEXT NOT NULL,
  content TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- 댓글 테이블
CREATE TABLE comments (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  question_id UUID REFERENCES questions(id) ON DELETE CASCADE,
  member_id UUID REFERENCES members(id),
  content TEXT NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### 📁 파일 구조 업데이트

```
online-library-app/
├── app/
│   ├── page.js              # 메인 대시보드 (스터디룸)
│   ├── layout.js            # 레이아웃
│   ├── globals.css          # 전역 스타일
│   ├── qna/                  # 💬 토론의 방 (신규)
│   │   └── page.js          # Q&A 페이지 (마크다운, URL 미리보기 지원)
│   └── interview/           # 📚 면접 시뮬레이터
│       ├── page.js
│       └── admin/
│           └── page.js
├── package.json             # react-markdown, remark-breaks 추가
└── 작업로그.md
```

#### 4. 질문 목록에 댓글 수 표시
- 각 질문 옆에 💬 아이콘과 댓글 개수 표시
- Supabase `comments(count)` 쿼리 활용
- 커밋: `101130b`

#### 5. 글쓰기 UI 개선
- 텍스트 영역 높이 증가 (rows 5 → 10)
- 세로 리사이즈 가능하도록 변경
- 마크다운 문법 안내를 텍스트 영역 아래 별도 박스로 표시
- 구글 드라이브 링크 안내 추가
- 커밋: `ec5f8da`, `bb45f85`, `81ce0f9`

#### 6. URL 자동 링크 변환
- `remark-gfm` 플러그인 추가
- 일반 텍스트로 붙여넣은 URL도 자동으로 클릭 가능한 링크로 변환
- 커밋: `da5d052`

#### 7. 글 수정 화면 안내 문구 추가
- 수정 모드에서도 마크다운 안내 박스 표시
- 커밋: `fc0f013`

### ✅ 완료 상태
- [x] 채팅/알림 기능 삭제 (Egress 절감)
- [x] 토론의 방 페이지 생성
- [x] 글/댓글 CRUD 기능
- [x] URL 링크 자동 미리보기
- [x] 마크다운 지원
- [x] 줄바꿈 지원
- [x] 질문 목록에 댓글 수 표시
- [x] 글쓰기 UI 개선 (높이 증가, 안내 문구)
- [x] URL 자동 링크 변환 (remark-gfm)
- [x] 글 수정 화면 안내 문구

---

## 2026년 2월 3일 - 토론의 방 기능 확장 및 UI 개선

### 🔧 작업 내용

#### 1. 댓글 마크다운 지원
- 댓글에도 본문과 동일한 마크다운 기능 추가
- 댓글 입력창을 textarea로 변경
- 마크다운 안내 추가

#### 2. NEW 뱃지 기능 추가
- 24시간 이내 작성된 게시글에 NEW 뱃지 표시
- 그라데이션 스타일 (rose → orange) + 펄스 애니메이션
- 메인 페이지 "토론의 방" 버튼에 알림 뱃지 (신규 글 수)

#### 3. 메인 페이지 리팩토링
- 누적 학습시간 랭킹 섹션 삭제
- 멤버 현황 | 오늘의 학습시간 | 실시간 기록을 한 줄 배치 (`sm:grid-cols-3`)
- D-day, 버튼, 섹션 전반 크기 축소
- 반응형 브레이크포인트 변경 (md → sm: 640px)

#### 4. Q&A 미리보기 임베딩
- 메인 페이지에 최근 5개 질문 제목 표시
- NEW 뱃지 포함, 클릭 시 토론의 방으로 이동

#### 5. 버튼 스타일 개선
- 원색 → 파스텔 톤 + 테두리 스타일로 변경
- 도서관 입실: 에메랄드
- 토론의 방: 블루
- 면접 연습: 퍼플
- 학습 시간/종료: 앰버/로즈

#### 6. 토론의 방 텍스트 크기 축소
- 헤더, 질문 목록: 아바타/제목/내용 크기 축소
- 질문 상세: 아바타, 이름, 날짜, 제목 축소
- 댓글 섹션: 아바타, 댓글 텍스트, 입력폼 축소
- 새 질문 모달: 전반적 크기 축소
- 마크다운 렌더링 스타일 축소

### ✅ 완료 상태
- [x] 댓글 마크다운 지원
- [x] NEW 뱃지 기능 (24시간 이내)
- [x] 메인 페이지 레이아웃 리팩토링
- [x] Q&A 미리보기 임베딩
- [x] 버튼 파스텔 톤 스타일링
- [x] 토론의 방 전반 텍스트 크기 축소

---

*마지막 업데이트: 2026년 2월 3일*
